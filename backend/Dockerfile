# 1. Базовый образ
# Используем официальный образ Python 3.11. Slim-версия меньше по размеру.
FROM python:3.11-slim

# 2. Установка рабочей директории
# Все последующие команды будут выполняться внутри этой папки в контейнере.
WORKDIR /app

# 3. Копирование файла с зависимостями
# Копируем только этот файл, чтобы Docker мог кэшировать слой с установленными библиотеками.
COPY requirements.txt .

# 4. Установка зависимостей
# --no-cache-dir уменьшает размер итогового образа.
RUN pip install --no-cache-dir -r requirements.txt

# 5. Копирование всех файлов проекта
# Копируем main.py, users.json и другие необходимые файлы в рабочую директорию /app.
COPY . .

# 6. Указание порта
# Сообщаем Docker, что приложение внутри контейнера будет работать на порту 8001.
EXPOSE 8001

# 7. Команда для запуска приложения
# Запускаем Uvicorn. Важно: --host 0.0.0.0 обязателен для работы внутри Docker.
# Флаг --reload здесь не используется, так как это для продакшн-сборки.
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]